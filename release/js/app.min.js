"use strict";var myApp=angular.module("myApp",["modalDialogDirective","selectCityDirective","rollerPickerDirective","datePicker.flight","ngTouch","services","templates-main"]);myApp.controller("TestController",["$scope",function(a){a.modalDialog={title:"模态框",show:!0,footerButton:2}}]),myApp.controller("SelectCityController",["$scope","$http","$log",function(a,b,c){a.show=function(){a.$broadcast("openSelectCity",{})},a.selectCityConfig={url:"./jsonData/visaProvince.json",type:"visa-province"},a.$on("setCityName",function(a,b){c.info(b)}),a.$on("closeSelectCity",function(a,b){c.info("隐藏城市选择")})}]),myApp.controller("RPParentController",["$scope","$http",function(a,b){a.$on("onSelectDate",function(b,c){a.dateData=c}),a.datePickerConfig={url:"./jsonData/date.json",postData:123123123123,version:null,nextStepCallBack:function(){alert("用户自定义下一步请求回调")}}}]),myApp.controller("DPBaseController",["$scope","$log",function(a,b){a.openGoTripDatePicker=function(){a.$broadcast("openGoTripDatePicker",{dateType:"goTrip"})},a.openBackTripDatePicker=function(){a.$broadcast("openBackTripDatePicker",{dateType:"backTrip"})},a.openGoDatePricePicker=function(){a.$broadcast("openGoDatePricePicker",{dateType:"goTrip",renderType:"goDatePrice"})},a.openBackDatePricePicker=function(){a.$broadcast("openBackDatePricePicker",{dateType:"backTrip",renderType:"backDatePrice"})},a.prevDay=function(b){"go"===b?a.$broadcast("prevDay",{dateType:"goTrip"}):a.$broadcast("prevDay",{dateType:"backTrip"})},a.nextDay=function(b){"go"===b?a.$broadcast("nextDay",{dateType:"goTrip"}):a.$broadcast("nextDay",{dateType:"backTrip"})},a.dpConfig={url:""},a.$on("onSelectDate",function(c,d){b.info(d),a.goTripDate=d.goDateInfo.curDateObj.dateFormat,a.goTripDay=" "+d.goDateInfo.curDateObj.cnDay,a.backTripDate=d.backDateInfo.curDateObj.dateFormat,a.backTripDay=" "+d.backDateInfo.curDateObj.cnDay})}]);var datePickerBase=angular.module("datePicker.base",[]);datePickerBase.directive("datePicker",function(){return{restrict:"EA",templateUrl:"./templates/datePicker-base.tpl.html",replace:!0,transclude:!0,scope:{dpConfig:"=dpConfig"},require:["datePicker"],controller:"DatePickerController",controllerAs:"DPController"}}).controller("DatePickerController",["$scope","$element",function(a,b){var c,d,e,f=this,g=["周日","周一","周二","周三","周四","周五","周六"],h=[0,31,29,31,30,31,30,31,31,30,31,30,31],i=12;f.dateArray=[],f.init=function(){f.open=!0,f.requestData(),c=f.getBeginDate(),d=f.getEndDate(),e=f.getRenderEndDate(),f.renderDate()},f.requestData=function(){},f.closeDatePicker=function(){f.open=!f.open,f.scope.$emit("closeDatePicker")},f.getDate=function(a){var b,c,d,e,f=new Date;if(angular.isUndefined(a))return b=f.getFullYear(),c=f.getMonth()+1,d=f.getDate(),e=g[f.getDay()],[b,c,d,e];if(angular.isObject(a)){{var h,i,j,k,l,m,n=a.addType||"d",o=a.dateArr,p=a.addNum||1;a.isBreak||!0}switch(b=o[0],c=o[1]-1,d=o[2],n){case"d":i=f.setDate(d+p);break;case"m":i=f.setMonth(c+p);break;case"y":i=f.setFullYear(b+p)}return h=new Date(i),l=h.getDate(),k=h.getMonth()+1,j=h.getFullYear(),m=h.getDay(),[j,k,l,m]}},f.getBeginDate=function(){return f.getDate()},f.getEndDate=function(){return f.getDate({dateArr:c,addNum:90})},f.getRenderEndDate=function(){return f.getDate({dateArr:c,addType:"y"})},f.renderDate=function(){for(var a,b,d,e,h,j,k=c[0],l=c[1],m=(c[2],new Date),n=0,o=!1,p=0;i>p;p++){l>12&&(l=1,k++),f.dateArray[p]={year:k,month:l},m.setDate(1),m.setMonth(l-1),m.setFullYear(k),f.dateArray[p].dateObj=[],a=f.getDateIndex(k,l-1,1),b=a+f.getDaysInMonth(k,l);for(var q=0;b>q;q++)if(h=j=!1,a>q)f.dateArray[p].dateObj[q]={isUsable:o,renderDate:"",date:""};else{switch(d=m.getDate(),k===c[0]&&l===c[1]&&d===c[2]&&(n=1,o=!0),n){case 1:d="今天",n++,h=!0;break;case 2:d="明天",n++,h=j=!0;break;case 3:d="后天",n++,h=!0}f.dateArray[p].dateObj[q]={isUsable:o,renderDate:d,date:[k,l,m.getDate(),m.getDay(),g[m.getDay()]],isHighLight:h,isSelected:j},m.setDate(m.getDate()+1)}l++,e=f.getDateIndex(k,l-1,0);for(var r=0;6-e>r;r++)f.dateArray[p].dateObj[q+r]={isUsable:!1,renderDate:"",date:""}}},f.selectDate=function(a,b){if(a.isUsable){var c=b.target,d=angular.element(c),e="selected",g=d.parent(),h=g.children();if("SPAN"===c.nodeName.toLocaleUpperCase()){if(d.hasClass(e))return;h.removeClass(e),d.addClass(e)}f.emitSelectDateEvent(a)}},f.emitSelectDateEvent=function(b){a.$emit("onSelectDate",b)},f.getDateIndex=function(a,b,c){return new Date(a,b,c).getDay()},f.fixIosStyle=function(){cm.isIosDevice()&&(cm.$(".tt-header").css({position:"relative",top:"0"}),cm.$("#container").css({paddingTop:"0",top:"0",position:"absolute"}),cm.$(".addspace").css("background","#d30775"))},f.getDaysInMonth=function(a,b){return 2===b&&a%4===0&&a%100===0||a%400===0?28:h[b]},f.init()}]);var datePickerDirective=angular.module("datePickerDirective",[]);datePickerDirective.directive("datePicker",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{dateConfig:"="},templateUrl:"./templates/datePicker.tpl.html",controller:"DatePickerController",controllerAs:"DPController"}}).controller("DatePickerController",["$scope","$element","$http","$location","$log","Ajax",function(a,b,c,d,e,f){var g=this,h="",i="",j="",k=[0,31,29,31,30,31,30,31,31,30,31,30,31],l=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];g.dateList=[],g.renderMonthCount=6,g.datePickerConfig=a.dateConfig;var m=g.datePickerConfig.url,n=g.datePickerConfig.postData,o=g.datePickerConfig.nextStepCallBack;g.init=function(){g.show=!0,g.count=a.count=1,g.startDateArr=g.getDateArr(h),g.visaDateArr=g.getDateArr(i),g.setDatePickerData()},g.nextStep=function(){return g.dateArr?(g.emitEvent(),void(angular.isFunction(o)&&o())):void alert("请选择游玩日期")},g.countIncrease=function(){a.count++},g.countDecrease=function(){a.count>1&&a.count--},g.getServerDate=function(){var a=d.absUrl(),b=f.get({url:a}),c=f.post({url:m,data:n});b.then(function(a){h=a.headers("date"),c.then(function(a){a&&(j=a.data.data.list[0].specDate,i=g.rebuildServerDate(j),g.init())})})},g.rebuildServerDate=function(a){var b=a.split("-"),c=b[0],d=b[1],e=b[2],f=parseInt(d,10),g=parseInt(e,10),h=parseInt(c,10);return new Date(h,f-1,g)},g.close=function(){g.show=!g.show},g.getDateArr=function(a){var b=new Date(a),c=b.getDate(),d=b.getMonth()+1,f=b.getFullYear();return e.info(f,d,c),[f,d,c]},g.getDateAdd=function(a,b,c){if(a&&b){var d,e,f=1,h=b,i=a[0],j=a[1]-1,k=a[2];switch(angular.isNumber(c)&&(f=c),h){case"d":d=(new Date).setDate(k+f);break;case"m":d=(new Date).setMonth(j+f);break;case"y":d=(new Date).setFullYear(i+f)}return e=new Date(d),[e.getFullYear(),e.getMonth()+1,e.getDate(),g.getChineseDay(e)]}},g.isLeapYear=function(a,b){return 2===a&&(b%4===0&&b%100===0||b%400===0)?28:k[a]},g.getRenderMonthCount=function(){var a=g.startDateArr[1],b=g.startDateArr[0],c=g.endDateArr[1],d=g.endDateArr[0];return 12*(d-b)+(c-a)+1},g.setDatePickerData=function(){for(var a=0,b=0,c=!1,d=g.startDateArr[0],e=g.startDateArr[1],f=g.startDateArr[2],h=g.visaDateArr[2],i=g.visaDateArr[1],j=g.visaDateArr[0];a<g.renderMonthCount;a++){var k=g.isLeapYear(e,d),l=g.getDateDay(e,d),m=g.getDateDay(e,d,!0),n=new Date;n.setDate(1),n.setMonth(e-1),n.setFullYear(d),e>12&&(e=1,d++),g.dateList[a]={year:d,month:e},e++,g.dateList[a].dateInfo=[];for(var o=0;l+k>o;o++){var p=!1,q=!1;if(l>o)g.dateList[a].dateInfo[o]={renderDate:"",date:"",isUsable:c,isHighLight:p,isSelected:q};else{var r=n.getDate(),s=n.getMonth()+1,t=n.getFullYear(),u=n.getDay();switch(r===f&&s===g.startDateArr[1]&&t===g.startDateArr[0]&&(b=1),r===h&&s===i&&t===j&&(c=!0),(0===u||6===u)&&(p=!0),b){case 1:r="今天",b++,p=!0;break;case 2:r="明天",b++,p=!0;break;case 3:r="后天",b++,p=!0}g.dateList[a].dateInfo[o]={renderDate:r,date:[d,e-1,n.getDate(),g.getChineseDay(n)],isUsable:c,isHighLight:p,isSelected:q},n.setDate(n.getDate()+1)}}for(var v=0;6-m>v;v++)g.dateList[a].dateInfo[o+v]={renderDate:"",date:"",isUsable:c,isHighLight:p,isSelected:q}}},g.dateStringify=function(a){var b,c,d,e=a.getFullYear(),f=a.getMonth()+1,g=a.getDate(),h="0";return b=""+e,c=10>f?h+f:""+f,d=10>g?h+g:""+g,b+"-"+c+"-"+d},g.getChineseDay=function(a){return l[a.getDay()]},g.emitEvent=function(){var b={dateArr:g.dateArr,count:a.count};a.$emit("onSelectDate",b)},g.selectDate=function(a,c){var d=c.isUsable;if(!d)return!1;var e=b.find("section").children().find("span"),f=angular.element(a.target);"SPAN"===a.target.nodeName.toUpperCase()&&(f.hasClass("selected")||(e.removeClass("selected"),f.addClass("selected"))),g.dateArr=c.date},g.getDateDay=function(a,b,c){var d;return d=c?new Date(b,a,0):new Date(b,a-1,1),d.getDay()},g.getServerDate()}]);var datePickerFlight=angular.module("datePicker.flight",[]);datePickerFlight.directive("datePicker",function(){return{restrict:"EA",templateUrl:"./templates/datePicker-flight.tpl.html",replace:!0,transclude:!0,scope:{dpConfig:"=dpConfig"},require:["datePicker"],controller:"DatePickerController",controllerAs:"DPController"}}).controller("DatePickerController",["$scope","$element","$http","$log",function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this,n=["周日","周一","周二","周三","周四","周五","周六"],o=[0,31,29,31,30,31,30,31,31,30,31,30,31],p=!0,q=2,r=[],s=a.dpConfig.url,t={goTripTitle:"去程日期选择",backTripTitle:"返程日期选择",goDatePriceTitle:"低价日历（去程）",backDatePriceTitle:"低价日历（返程）"};if(m.goTripDateArr=null,m.backTripDateArr=null,m.dateType=null,m.renderType=null,m.title="",m.initDateObj=null,m.lastPriceDateObj=null,Mock.Random)var u={"code|1-10":1,"data|30":[{deptDate:"@DATE",flightNO:"MH370","seatCode|4":"1","parPrice|100-2000":100}]},v=Mock.mock(u);m.init=function(a){m.dateArray=[];var b=m.requestData();b.success(function(){e=m.getBeginDate(),g=m.getFormatDate(e),f=m.getEndDate(),h=m.getFormatDate(f),j=m.getRenderMonthCount(),i=m.getRenderEndDate(),m.setTitle(),m.renderDate(),p?m.initDate():m.open=a})},m.initDate=function(){d.info("初始化日期"),m.emitSelectDateEvent(m.initDateObj),m.open=!1},m.setTitle=function(){var a=m.dateType,b=m.renderType;b?"goDatePrice"===b?m.title=t.goDatePriceTitle:"backDatePrice"===b&&(m.title=t.backDatePriceTitle):("goTrip"===a&&(m.title=t.goTripTitle),"backTrip"===a&&(m.title=t.backTripTitle))},m.getRenderMonthCount=function(){var a=m.dateType,b=m.renderType;return(p||("goTrip"===a||"backTrip"===a)&&!b)&&(j=12),b&&(j=12*(f[0]-e[0])+(f[1]-e[1])+1),j},m.requestData=function(){var a=c({method:"POST",url:s,params:{startDate:g,endDate:h}});return a.success(function(a,b,c){k=v?v.data:a.data,l=c("date")}),a.error(function(a,b,c){}),a},a.$on("openGoTripDatePicker",function(a,b){m.openDatePicker(a,b,!0),m.renderType=null}),a.$on("openBackTripDatePicker",function(a,b){m.openDatePicker(a,b,!0),m.renderType=null}),a.$on("openGoDatePricePicker",function(a,b){m.openDatePicker(a,b,!0)}),a.$on("openBackDatePricePicker",function(a,b){m.openDatePicker(a,b,!0)}),a.$on("prevDay",function(a,b){d.info("前一天"),m.openDatePicker(a,b,!1),"goTrip"===m.dateType&&m.goTripPrevDay(),"backTrip"===m.dateType&&m.backTripPrevDay()}),a.$on("nextDay",function(a,b){d.info("后一天"),m.openDatePicker(a,b,!1),"goTrip"===m.dateType&&m.goTripNextDay(),"backTrip"===m.dateType&&m.backTripNextDay()}),m.goTripPrevDay=function(){var a,b,c=m.getStorageGoDateInfo(),d=c.curDateObj,f=d.dateArr;a=!m.dateCompare(e,f),a||(b=m.getPrevDateObj(d),m.emitSelectDateEvent(b))},m.goTripNextDay=function(){var a,b,c=m.getStorageGoDateInfo(),d=c.curDateObj,e=d.dateArr,f=m.lastPriceDateObj;a=!m.dateCompare(e,f.dateArr),a||(b=m.getNextDateObj(d),m.emitSelectDateEvent(b))},m.backTripPrevDay=function(){var a,b,c=m.getStorageBackDateInfo(),d=m.getStorageGoDateInfo(),e=c.curDateObj,f=d.curDateObj;a=e.index===f.index+1,a||(b=m.getPrevDateObj(e),m.emitSelectDateEvent(b))},m.backTripNextDay=function(){var a,b,c=m.getStorageBackDateInfo(),d=c.curDateObj,e=m.lastPriceDateObj;a=!m.dateCompare(d.dateArr,e.dateArr),a||(b=m.getNextDateObj(d),m.emitSelectDateEvent(b))},m.openDatePicker=function(a,b,c){m.open=c,angular.isObject(b)&&(angular.isString(b.dateType)&&(m.dateType=b.dateType),angular.isString(b.renderType)&&(m.renderType=b.renderType)),m.init(c)},m.closeDatePicker=function(){m.open=!1,p=!1,a.$emit("closeDatePicker",{})},m.getDate=function(a){var b,c,d,e,f=new Date(l);if(angular.isUndefined(a))return b=f.getFullYear(),c=f.getMonth()+1,d=f.getDate(),e=f.getDay(),[b,c,d,e];if(angular.isObject(a)){{var g,h,i,j,k,m,n=a.addType||"d",o=a.dateArr,p=a.addNum||1;a.isBreak||!0}switch(b=o[0],c=o[1]-1,d=o[2],f=new Date(b,c,d),n){case"d":h=f.setDate(d+p);break;case"m":h=f.setMonth(c+p);break;case"y":h=f.setFullYear(b+p)}return g=new Date(h),k=g.getDate(),j=g.getMonth()+1,i=g.getFullYear(),m=g.getDay(),[i,j,k,m]}},m.getBeginDate=function(){return m.getDate()},m.getEndDate=function(){return m.getDate({dateArr:e,addNum:30})},m.getRenderEndDate=function(){return m.getDate({dateArr:e,addType:"y"})},m.renderDate=function(){var a,b,c,d,f,g,h,i,l,o,q,s,t,u=e[0],v=e[1],w=new Date,x=0,y=!1,z=angular.copy(k),A=0,B=!1,C=m.renderType,D=!1;p||(l=m.initDateObj.dateArr,o=m.getStorageBackDateInfo().curDateObj.dateArr);for(var E=0;j>E;E++){v>12&&(v=1,u++),m.dateArray[E]={year:u,month:v},w.setDate(1),w.setMonth(v-1),w.setFullYear(u),m.dateArray[E].dateObj=[],a=m.getDateIndex(u,v-1,1),b=a+m.getDaysInMonth(u,v);for(var F=0;b>F;F++)if(h=i=!1,a>F)m.dateArray[E].dateObj[F]={isUsable:y,renderDate:"",date:""};else{if(c=f=w.getDate(),t=n[w.getDay()],d=[u,v,f],!m.dateCompare(d,e)){x=1,y=!0,D=!0;var G=0}if(D&&(q=z[G],q&&q.parPrice?s=q.parPrice:(D=!1,m.lastPriceDateObj=m.dateArray[E].dateObj[F-1],C&&(y=!1)),G++),m.isSelectBackTrip()){var H=-1===m.dateCompare(d,l);y=C?H&&D:H,i=!m.dateCompare(d,o)&&y}else i=!m.dateCompare(d,l);switch(x){case 1:t=c="今天",x++,h=!0;break;case 2:t=c="明天",x++,h=!0,B=!0;break;case 3:t=c="后天",x++,h=!0}if(m.dateArray[E].dateObj[F]={isUsable:y,renderDate:c,dateArr:d.concat([w.getDay()]),cnDay:t,dateFormat:m.getFormatDate(d),isHighLight:h,isSelected:i,isHasPrice:D,price:s,dateArrIndex:E,index:A++},r.push(m.dateArray[E].dateObj[F]),w.setDate(w.getDate()+1),d=null,p&&B){var I=m.getStorageGoDateInfo();m.initDateObj=I?I.curDateObj:m.dateArray[E].dateObj[F],B=null}}v++,g=m.getDateIndex(u,v-1,0);for(var J=0;6-g>J;J++)m.dateArray[E].dateObj[F+J]={isUsable:!1,renderDate:"",date:""}}},m.dateCompare=function(a,b){var c,d;return angular.isArray(a)&&(c=m.dateArrToMs(a)),angular.isArray(b)&&(d=m.dateArrToMs(b)),c===d?0:d>c?1:-1},m.dateArrToMs=function(a){var b=new Date(a[0],a[1]-1,a[2]);return b.getTime()},m.hasGoTripDateObj=function(){var a,b=m.getStorageGoDateInfo();return angular.isObject(b)?(a=b.curDateObj,angular.isObject(a)):void 0},m.hasBackTripDateObj=function(){var a,b=m.getStorageBackDateInfo();return angular.isObject(b)&&(a=b.curDateObj),angular.isObject(a)},m.getStorageGoDateInfo=function(){var a,b=angular.fromJson(localStorage.getItem("datePickerData"));return angular.isObject(b)&&(a=b.goDateInfo,angular.isObject(a))?a:void 0},m.getStorageBackDateInfo=function(){var a,b=angular.fromJson(localStorage.getItem("datePickerData"));return angular.isObject(b)&&(a=b.backDateInfo,angular.isObject(a))?a:void 0},m.isSelectBackTrip=function(){return"backTrip"===m.dateType},m.getFormatDate=function(a,b,c){var d,e;if(3===arguments.length)return d=10>b?"0"+b:b,e=10>c?"0"+c:c,a+"-"+d+"-"+e;if(1===arguments.length&&angular.isArray(a)){var f=a[0],g=a[1],h=a[2];return m.getFormatDate(f,g,h)}},m.selectDate=function(a,c){if(a.isUsable){var d=c.target,e=angular.element(d),f="selected",g=b.find("article"),h=g.find("span");if("SPAN"===d.nodeName.toLocaleUpperCase()){if(e.hasClass(f))return;h.removeClass(f),e.addClass(f)}m.emitSelectDateEvent(a)}},m.emitSelectDateEvent=function(b){var c,d,e,f,g;m.isSelectBackTrip()?(f=m.getStorageGoDateInfo(),c=angular.isObject(f)?f.curDateObj:m.initDateObj,e=b):(c=b,m.isGoDateOverBack(c)?e=m.getBackDateObj(c):(g=m.getStorageBackDateInfo(),e=angular.isObject(g)?g.curDateObj:m.getBackDateObj())),d={goDateInfo:{curDateObj:c,preDateObj:m.getPrevDateObj(c),nextDateObj:m.getNextDateObj(c)},backDateInfo:{curDateObj:e,preDateObj:m.getPrevDateObj(e),nextDateObj:m.getNextDateObj(e)}},m.setDateObjCache(d),p||m.updateInitDateObj(),m.closeDatePicker(),a.$emit("onSelectDate",d)},m.updateInitDateObj=function(){var a=m.getStorageGoDateInfo();angular.isObject(a)&&(m.initDateObj=a.curDateObj)},m.getPrevDateObj=function(a){var b,c=a.index,d=c-1;return b=m.getDateObjByIndex(d)},m.getNextDateObj=function(a){var b,c=a.index,d=c+1;return b=m.getDateObjByIndex(d)},m.getDateObjByIndex=function(a){for(var b,c,d=r.length,e=0;d>e;e++)if(b=r[e],c=b.index,angular.isNumber(c)&&a===c)return b},m.setDateObjCache=function(a){m.emitData=a,localStorage.setItem("datePickerData",angular.toJson(a))},m.isGoDateOverBack=function(a){var b,c,d,e=a.index;return m.hasBackTripDateObj()?(c=m.getStorageBackDateInfo(),d=c.curDateObj.index):(b=m.getBackDateObj(),d=b.index),e>=d?!0:void 0},m.getBackDateObj=function(a){var b,c=a||m.initDateObj,d=c.index,e=d+q;return b=m.getDateObjByIndex(e)},m.getDateIndex=function(a,b,c){return new Date(a,b,c).getDay()},m.fixIosStyle=function(){cm.isIosDevice()&&(cm.$(".tt-header").css({position:"relative",top:"0"}),cm.$("#container").css({paddingTop:"0",top:"0",position:"absolute"}),cm.$(".addspace").css("background","#d30775"))},m.getDaysInMonth=function(a,b){return 2===b&&a%4===0&&a%100===0||a%400===0?28:o[b]},p&&m.init()}]);var modalDialogDirective=angular.module("modalDialogDirective",[]);modalDialogDirective.constant("modalDialogConfig",{width:"300px",marginTop:"90px",marginBottom:"90px",footerButton:[{buttonText:"确定",callBack:function(a){}},{buttonText:"取消",callBack:function(a){}}],show:!1,title:"模态框"}).directive("modalDialog",["$timeout","modalDialogConfig",function(a,b){return{restrict:"EA",replace:!0,transclude:!0,scope:{dialogConfig:"=dialogConfig"},template:'<div id="myDialog" class="modal-layer" ng-show="ModalDialogController.show" ng-click="ModalDialogController.close($event)"><div class="modal-dialog"><div class="modal-content" ng-switch on="dialogConfig.footerButton"><div class="modal-header"><a class="modal-close" ng-click="ModalDialogController.close($event)">X</a><h4>{{ModalDialogController.title}}</h4></div><div class="modal-body" ng-transclude></div><div class="modal-footer"><button></button><button></button></div></div></div></div>',require:["modalDialog"],controller:["$scope","$element",function(a,c,d){var e=this,f=document,g=c.children(),h=g.children(),i=angular.extend(b,a.dialogConfig);e.show=i.show,e.title=i.title,e.init=function(){e.setModalStyle(),angular.isArray(b.footerButton)&&b.footerButton.length>0},e.setModalStyle=function(){var a=b.width,c=b.marginTop,d=b.marginBottom;g.css({width:a,marginTop:c,marginBottom:d})},e.open=function(){e.show=!0},e.close=function(a){a.stopPropagation();var b=a.target,c=b.getAttribute("class");c&&(-1!==c.indexOf("modal-layer")||-1!==c.indexOf("modal-close"))&&(e.show=!e.show)},e.setFooter=function(){var a=0,c=b.footerButton,d=c.length,e="",f=null,g="",i='<div class="modal-footer"></div>';h.append(i);var k=j.$(".modal-footer");switch(d){case 1:if(angular.isObject(c[a])){e=c[a].buttonText,f=c[a].callBack,g='<button id="modal-btn" class="modal-btn">'+e+"</button>",k.append();break}throw new Error(c[a]+"must be a Object");case 2:for(;d>a;a++){if(!angular.isObject(c[a]))throw new Error(c[a]+"must be a Object");f=c[a].callBack,g='<button id="modal-btn'+[a]+'">'+c[a].buttonText+"</button>",k.append(g),angular.isFunction(f)&&g.on("click",f)}}};var j=j||{};j.$=function(a){var b=f.querySelectorAll.bind(f),c=b(a);return angular.element(c)}}],controllerAs:"ModalDialogController",link:function(a,b,c,d){{var e=d[0];d[1]}e.init(),e.open()}}}]);var rollerPickerDirective=angular.module("rollerPickerDirective",[]);rollerPickerDirective.constant("rollerPickerConfig",{}).directive("rollerPicker",["$document",function(a){return{restrict:"EA",replace:!0,require:"ngModel",link:function(a,b,c,d){}}}]);var selectCity=angular.module("selectCityDirective",[]);selectCity.directive("selectCity",["$http","dataManager","Ajax",function(a,b,c){return{restrict:"EA",replace:!0,transclude:!0,scope:{cityConfig:"="},templateUrl:"./templates/selectCity.tpl.html",require:["selectCity"],controller:function(a,d,e,f,g,h){var i=this,j=d,k=j.children().eq(2),l=k[0].clientHeight,m=j.children().eq(0)[0].clientHeight,n=a.cityConfig,o=n.url,p=n.type;i.type=p;var q,r=r||{},s=s||{},t=t||{};i.open=!1,a.$on("openSelectCity",function(a,b){i.open=!i.open,i.initHistorySelected()}),i.requestData=function(){var a=c.post({url:o});a.then(function(a){if(a.data)switch(p){case"visa-province":r.init(i,a.data);break;case"flight":s.init(i,a.data);break;case"train":t.init(i,a.data);break;case"visa-country":q=a.data}}),a.then(function(a){})},i.init=function(){i.initLetterListHeight(),i.setAnchor("#",!0),i.initHistorySelected()},i.initHistorySelected=function(){i.historySelectedList=angular.fromJson(localStorage.getItem("historySelectedList"))},i.initLetterListHeight=function(){var a=k.children(),b=l%26;i.itemHeight=(l-b)/26,a.css({height:i.itemHeight+"px"}),"visa-province"===p||"visa-country"===p?i.itemPt=b+50:i.itemPt=b,k.css("padding-top",i.itemPt+"px")},i.setAnchor=function(a,b){if(a){var c="",d=b||!1;if(angular.isString(a)&&(c=-1===a.indexOf("#")?a:a.replace("#",""),d&&(g.hash(c),h(),i.fixAnchorStyle(c))),angular.isArray(a)){for(var e=0,f=a.length,j=[],k="";f>e;e++)0!==e&&(k="#"+a[e],j.push(k));return j}}},i.fixAnchorStyle=function(a){},i.close=function(){i.open=!i.open,a.$emit("closeSelectCity",{})},t=function(a,b){return{letterList:[],otherLetters:["pt","CURRENT","HISTORY","HOT"],hasOtherAnchor:!0,anchorWord:null,cityList:null,historySelectedList:[],currentCity:"上海",getCityFirstLetter:function(){if(b.isArray(this.cityList)){var a=0,c=this.cityList,d=c.length;if(d){for(;d>a;a++)for(var f in c[a])if("firstletter"===f&&(0===a||c[a-1][f]!==c[a][f])){var g=c[a][f],h=e("uppercase")(g);this.letterList.push(h)}return this.letterList.sort(),this}}},getAnchorWord:function(){return this.anchorWord=this.otherLetters.concat(this.letterList),this.anchorWord.splice(0,1),this},getCityList:function(a){return this.cityList=a.data,this},bindControllerData:function(a){return a.cityList=this.cityList,a.letterList=this.letterList,a.anchorWord=this.anchorWord,a.hasOtherAnchor=this.hasOtherAnchor,a.currentCity=this.currentCity,a.inputPlaceholder="输入城市名或拼音",a.curPosition="当前定位城市区域",a.historyOptions="历史选择城市",this},updateHistorySelected:function(a,b){return b.updateHistorySelected(a,this),localStorage.setItem("currentCity",this.currentCity),this},init:function(a,b){this.getCityList(b).getCityFirstLetter().getAnchorWord().bindControllerData(a),a.init(),a.bindIndexEvent(this.anchorWord)}}}(f,angular),s=function(a,b){return{letterList:[],anchorWord:["pt","CURRENT","HISTORY","HOT"],hasOtherAnchor:!0,cityList:null,currentCity:null,hotCitys:null,historySelectedList:[],getCityFirstLetter:function(){var a=this.cityList;if(b.isArray(a)){var c=a.length,d=0,e=[];if(!c)return;for(;c>d;d++)e.push(a[d].firstLetter);for(var f=e.length,g=0;f>g;g++)(0===g||-1===this.letterList.indexOf(e[g]))&&this.letterList.push(e[g]);this.letterList.sort()}return this},getCityList:function(a){return this.cityList=a.data.allCitys,this},getCurrentCity:function(a){return this.currentCity=a.data.currentCity.name,this},getHotCity:function(a){return this.hotCitys=a.data.hotCitys,this},getAnchorWord:function(){return this.anchorWord=this.anchorWord.concat(this.letterList),this.anchorWord.splice(0,1),this},bindControllerData:function(a){return a.letterList=this.letterList,a.anchorWord=this.anchorWord,a.hasOtherAnchor=this.hasOtherAnchor,a.cityList=this.cityList,a.currentCity=this.currentCity,a.hotCitys=this.hotCitys,a.inputPlaceholder="输入城市名或拼音",a.curPosition="当前定位城市区域",a.historyOptions="历史选择城市",this},updateHistorySelected:function(a,b){return b.updateHistorySelected(a,this),this},init:function(a,b){s.getCityList(b).getCurrentCity(b).getHotCity(b).getCityFirstLetter().getAnchorWord().bindControllerData(a),a.init(),a.bindIndexEvent(this.anchorWord)}}}(f,angular),r=function(a,c){return{letterList:[],anchorWord:null,provinceList:null,historySelectedList:[],currentCity:{station_name:"上海"},getProvinceFirstLetter:function(){if(c.isArray(this.provinceList)){for(var a,b,d,f=this.provinceList,g=f.length,h=[],i=0;g>i;i++)a=f[i],b=a.pinyin,h.push(b[0]);for(var j=h.length,k=0;j>k;k++)(0===k||h[k-1]!==h[k])&&(d=e("uppercase")(h[k]),this.letterList.push(d)),a=f[k],a.firstletter=e("uppercase")(h[k]),this.letterList.sort();return this}},getProvinceList:function(a){return this.provinceList=a.data,this},getAnchorWord:function(){return this.anchorWord=this.letterList,this},bindControllerData:function(a){var b=localStorage.getItem("historySelectedList");return a.provinceList=this.provinceList,a.letterList=this.letterList,a.anchorWord=this.anchorWord,a.currentCity=this.currentCity.station_name,a.inputPlaceholder="输入省份或自治区，直辖市",a.curPosition="当前定位区域",a.historyOptions="历史选择",b&&b.length>0&&(a.historySelectedList=b),this},setSearchData:function(){var a=this.provinceList,d={},e="";return c.forEach(a,function(a,b){e=a.station_name.substr(0,1),d[e]=a.pinyin.substr(0,1)}),b.setData("cnLetterObj",d),this},updateHistorySelected:function(a,b){return b.updateHistorySelected(a,this),this},init:function(a,b){this.getProvinceList(b).getProvinceFirstLetter().getAnchorWord().bindControllerData(a),a.init(),a.bindIndexEvent(this.anchorWord)}}}(f,angular),i.updateHistorySelected=function(a,b){if(angular.isObject(a)){var c=f.localStorage,d=angular.fromJson(c.getItem("historySelectedList"));if(d&&d.length>0)for(var e=d.length,g=0;e>g;g++){var h=d[g];if(angular.equals(h,a)){var j=d[0];return d[0]=h,d[g]=j,void c.setItem("historySelectedList",angular.toJson(d))}}b.historySelectedList.unshift(a),b.historySelectedList.length>6&&(b.historySelectedList.length=6),c.setItem("historySelectedList",angular.toJson(b.historySelectedList))}var k=b.historySelectedList;k&&k.length>0&&(i.historySelectedList=k)},i.selectCity=function(b,c){var d;switch(p){case"visa-province":c?d={station_name:b}:(r.updateHistorySelected(b,i),d=b);break;case"train":c?d={cityname:b}:t.updateHistorySelected(b,i);break;case"flight":c?d={name:b}:s.updateHistorySelected(b,i)}a.$emit("setCityName",d),i.close()},i.bindIndexEvent=function(a){var b=a.length,c={};k.on("touchstart",function(a){var b=a.target;if("A"===b.nodeName.toLocaleUpperCase()){var c=b.parentNode,d=c.dataset.name;i.setAnchor(d,!0)}j.off(),j.on("touchstart",function(a){return a.preventDefault(),!1}),j.on("touchmove",function(a){return a.preventDefault(),!1})}),k.on("touchmove",function(d){var e,f=i.itemHeight,g=i.itemPt,h=10,j=m,k=0;for(d.originalEvent?e=d.originalEvent.changedTouches[0].clientY-h:d.changedTouches&&(e=d.changedTouches[0].clientY-h);b>k;k++)0!==k?c[a[k]]=e>g+j+(k-1)*f&&k*f+g+j>=e:c[a[k]]=k*f+g+j>=e;for(var l in c)if(c[l]){i.setAnchor(l,!0);break}})},k.on("touchend",function(a){j.off()}),i.requestData()},controllerAs:"SelectCityController"}}]).filter("searchLetterFilter",["$filter",function(a){var b=/[a-zA-Z]/;return function(c,d){return a("uppercase")(angular.isString(d)&&d.length>0?b.test(d[0])?d[0]:c:c)}}]).filter("searchCityListFilter",["$filter",function(a){return function(b,c,d){var e=[];return angular.isArray(b)&&b.length>0?(angular.forEach(b,function(b,f){b.firstletter===a("uppercase")(d)&&(angular.isString(c)&&c.length>0?-1!==b.pinyin.indexOf(c)&&e.push(b):e.push(b))}),e):void 0}}]);var serviceModule=angular.module("services",[]);serviceModule.factory("dataManager",["$log",function(a){var b={};return{setData:function(a,c){angular.isString(a)&&c&&(this.removeData(a),b[a]=c)},getData:function(a){return angular.isString(a)?b[a]||{}:void 0},removeData:function(a){b[a]&&(b[a]=null)}}}]),serviceModule.factory("Ajax",["$log","$q","$http",function(a,b,c){return{post:function(a){var d=b.defer(),e=a.url,f=a.data;return c.post(e,f).success(function(a,b,c){d.resolve({data:a,status:b,headers:c})}).error(function(a,b,c){d.reject(a)}),d.promise},get:function(a){var d=b.defer(),e=a.url;return c.get(e).success(function(a,b,c){d.resolve({data:a,status:b,headers:c})}).error(function(a,b,c){d.reject(a)}),d.promise}}}]),angular.module("templates-main",["../templates/datePicker-base.tpl.html","../templates/datePicker-flight.tpl.html","../templates/datePicker.tpl.html","../templates/rollerPicker.tpl.html","../templates/selectCity.tpl.html"]),angular.module("../templates/datePicker-base.tpl.html",[]).run(["$templateCache",function(a){a.put("../templates/datePicker-base.tpl.html",'<div class="g-dp-ctn" ng-show="DPController.open">\n    <header class="g-dp-hd">\n        <span class="u-back-btn" ng-click="DPController.closeDatePicker()"></span>\n        选择日期\n    </header>\n    <article class="g-dp-bd">\n        <section class="m-dp-date" ng-repeat="date in DPController.dateArray">\n            <p>{{date.year}}年{{date.month}}月</p>\n            <div class="m-dp-day">\n                <div>日</div>\n                <div>一</div>\n                <div>二</div>\n                <div>三</div>\n                <div>四</div>\n                <div>五</div>\n                <div>六</div>\n            </div>\n            <div>\n                <span ng-click="DPController.selectDate(dateInfo, $event)"\n                      ng-class="{usable: dateInfo.isUsable, highLight: dateInfo.isHighLight, selected: dateInfo.isSelected}"\n                      ng-repeat="dateInfo in date.dateObj">\n                    {{dateInfo.renderDate}}\n                    <!--<i>&#165</i>-->\n                </span>\n            </div>\n        </section>\n    </article>\n</div>\n')}]),angular.module("../templates/datePicker-flight.tpl.html",[]).run(["$templateCache",function(a){a.put("../templates/datePicker-flight.tpl.html",'<div class="g-dp-ctn" ng-show="DPController.open">\n    <header class="g-dp-hd">\n        <span class="u-back-btn" ng-click="DPController.closeDatePicker()"></span>\n        {{DPController.title}}\n    </header>\n    <article class="g-dp-bd">\n        <div class="m-dp-day">\n            <div>日</div>\n            <div>一</div>\n            <div>二</div>\n            <div>三</div>\n            <div>四</div>\n            <div>五</div>\n            <div>六</div>\n        </div>\n        <section class="m-dp-date" ng-repeat="date in DPController.dateArray">\n            <p>{{date.year}}年{{date.month}}月</p>\n            <div>\n                <span ng-click="DPController.selectDate(dateInfo, $event)"\n                      ng-class="{usable: dateInfo.isUsable, highLight: dateInfo.isHighLight, selected: dateInfo.isSelected, hasPrice: dateInfo.isHasPrice}"\n                      ng-repeat="dateInfo in date.dateObj">\n                    {{dateInfo.renderDate}}\n\n                    <i ng-if="dateInfo.isHasPrice && dateInfo.isUsable">&#165{{dateInfo.price}}</i>\n                </span>\n            </div>\n        </section>\n    </article>\n</div>\n')}]),angular.module("../templates/datePicker.tpl.html",[]).run(["$templateCache",function(a){a.put("../templates/datePicker.tpl.html",'<div class="g-dp-ctn" ng-show="DPController.show">\n    <header class="g-dp-hd">\n        <div class="u-dp-bk" ng-click="DPController.close()">\n            <a class="u-dp-bk-icon"></a>\n        </div>\n        <h1 class="u-dp-tt">选择游玩日期和分数</h1>\n    </header>\n    <article class="g-dp-bd">\n        <section class="m-dp-bd" ng-repeat="date in DPController.dateList">\n            <h2 class="u-dp-bd-tt">{{date.year}}年{{date.month}}月</h2>\n            <table class="m-dp-bd-day">\n                <thead>\n                    <tr>\n                        <td>日</td>\n                        <td>一</td>\n                        <td>二</td>\n                        <td>三</td>\n                        <td>四</td>\n                        <td>五</td>\n                        <td>六</td>\n                    </tr>\n                </thead>\n            </table>\n            <div class="m-dp-bd-date">\n                <span ng-repeat="dateInfo in date.dateInfo"\n                      ng-class="{unUsable: !dateInfo.isUsable, highLight: dateInfo.isHighLight, selected: dateInfo.isSelected}"\n                      ng-click="DPController.selectDate($event, dateInfo)">\n                    {{dateInfo.renderDate}}\n                </span>\n            </div>\n        </section>\n    </article>\n    <footer class="g-dp-ft">\n        <div class="m-dp-ft-l">\n            <span class="u-dp-ft-count-text">份数</span>\n            <div class="m-dp-ft-count">\n                <a class="u-dp-ft-count-minus" ng-click="DPController.countDecrease()">-</a>\n                <p class="u-dp-ft-count">{{count}}</p>\n                <a class="u-dp-ft-count-plus" ng-click="DPController.countIncrease()">+</a>\n            </div>\n        </div>\n        <div class="m-dp-ft-r">\n            <a class="u-dp-next-btn" ng-click="DPController.nextStep()">下一步</a>\n        </div>\n    </footer>\n</div>');

}]),angular.module("../templates/rollerPicker.tpl.html",[]).run(["$templateCache",function(a){a.put("../templates/rollerPicker.tpl.html","<div>\n    hello world\n</div>\n\n")}]),angular.module("../templates/selectCity.tpl.html",[]).run(["$templateCache",function(a){a.put("../templates/selectCity.tpl.html",'<div class="g-city-sct-container" ng-show="SelectCityController.open">\n    <div class="g-city-sct-hd">\n        <a class="u-back-btn" ng-click="SelectCityController.close()">取消</a>\n        <input id="j-city-srh" class="u-city-srh" type="search" placeholder="{{SelectCityController.inputPlaceholder}}"\n               ng-model="search"/>\n    </div>\n    <div class="g-city-sct-bd">\n        <ul class="city-list">\n            <li id="CURRENT" ng-if="!search">\n                <h4 class="u-city-sct-cur-hd">{{SelectCityController.curPosition}}</h4>\n                <div class="m-city-scr-cur">\n                    <div>\n                        <a ng-click="SelectCityController.selectCity(SelectCityController.currentCity, \'currentCity\')">{{SelectCityController.currentCity}}</a>\n                    </div>\n                </div>\n            </li>\n            <li id="HISTORY" ng-if="SelectCityController.historySelectedList && !search">\n                <h4 class="u-city-sct-hty-hd">{{SelectCityController.historyOptions}}</h4>\n                <div class="m-city-scr-hty">\n                    <div ng-repeat="item in SelectCityController.historySelectedList">\n                        <a ng-click="SelectCityController.selectCity(item)" ng-if="SelectCityController.type === \'train\'">{{item.cityname}}</a>\n                        <a ng-click="SelectCityController.selectCity(item)" ng-if="SelectCityController.type === \'flight\'">{{item.name}}</a>\n                        <a ng-click="SelectCityController.selectCity(item)" ng-if="SelectCityController.type === \'visa-province\'">{{item.station_name}}</a>\n                    </div>\n                </div>\n            </li>\n            <li id="HOT" ng-if="(SelectCityController.type === \'train\' || SelectCityController.type === \'flight\') && !search">\n                <h4 class="u-city-sct-hot-hd">热门城市</h4>\n                <div class="m-city-scr-hot">\n                    <div ng-if="SelectCityController.type === \'train\'"\n                         ng-repeat="city in SelectCityController.cityList | filter: {ishot: \'Y\'}">\n                        <a ng-click="SelectCityController.selectCity(city)">{{city.cityname}}</a>\n                    </div>\n                    <div ng-if="SelectCityController.type === \'flight\'"\n                         ng-repeat="city in SelectCityController.hotCitys">\n                        <a ng-click="SelectCityController.selectCity(city)">{{city.name}}</a>\n                    </div>\n                </div>\n            </li>\n            <li id="{{letter}}" ng-repeat="letter in SelectCityController.letterList | searchLetterFilter: search" >\n                <h4>{{letter}}</h4>\n                <ul class="m-city-list">\n                    <li ng-if="SelectCityController.type === \'train\'"\n                        ng-repeat="city in SelectCityController.cityList | filter: {firstletter: letter}"\n                        ng-click="SelectCityController.selectCity(city)">\n                        {{city.cityname}}\n                    </li>\n                    <li ng-if="SelectCityController.type === \'flight\'"\n                        ng-repeat="city in SelectCityController.cityList | filter:  {firstLetter: letter, pinYin: search} "\n                        ng-click="SelectCityController.selectCity(city)">\n                        {{city.name}}\n                    </li>\n                    <li ng-if="SelectCityController.type === \'visa-province\'"\n                        ng-repeat="province in SelectCityController.provinceList | searchCityListFilter: search : letter"\n                        ng-click="SelectCityController.selectCity(province)">\n                        {{province.station_name}}\n                    </li>\n                </ul>\n            </li>\n        </ul>\n    </div>\n    <ul class="g-letter-list">\n        <li data-name="{{anchor}}"\n            ng-if="SelectCityController.hasOtherAnchor"\n            ng-repeat="anchor in SelectCityController.anchorWord track by $index">\n            <a ng-if="anchor === \'CURRENT\'">当前</a>\n            <a ng-if="anchor === \'HISTORY\'">历史</a>\n            <a ng-if="anchor === \'HOT\'">热门</a>\n            <a ng-if="$index > 2">{{anchor}}</a>\n        </li>\n        <li data-name="{{anchor}}"\n            ng-if="!SelectCityController.hasOtherAnchor"\n            ng-repeat="anchor in SelectCityController.anchorWord">\n            <a>{{anchor}}</a>\n        </li>\n    </ul>\n</div>')}]);